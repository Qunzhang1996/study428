## 问题

堆区和栈区的区别是什么？



### 堆和栈的区别

● **管理方式不同：**栈是由编译器自动申请和释放空间，堆是需要程序员手动申请和释放；

● **空间大小不同：**栈的空间是有限的，在32位平台下，VC6下默认为1M，堆最大可以到4G；

● **能否产生碎片：**栈和数据结构中的栈原理相同，在弹出一个元素之前，上一个已经弹出了，不会产生碎片，如果不停地调用malloc、free对造成内存碎片很多；

● **生长方向不同：**堆生长方向是向上的，也就是向着内存地址增加的方向，栈刚好相反，向着内存减小的方向生长。

● **分配方式不同：**堆都是动态分配的，没有静态分配的堆。栈有静态分配和动态分配。静态分配是编译器完成的，比如局部变量的分配。动态分配由 malloc 函数进行分配，但是栈的动态分配和堆是不同的，它的动态分配是由编译器进行释放，无需我们手工实现。

● **分配效率不同：**栈的效率比堆高很多。栈是机器系统提供的数据结构，计算机在底层提供栈的支持，分配专门的寄存器来存放栈的地址，压栈出栈都有相应的指令，因此比较快。堆是由库函数提供的，机制很复杂，库函数会按照一定的算法进行搜索内存，因此比较慢。



### 静态全局变量与全局变量的区别

● 静态全局变量和全局变量都属于 **常量区**。

● 静态全局变量只在本文件中有效，别的文件想调用该变量是调不了的，而全局变量可以在别的文件中调用。

● 如果别的文件中定义了一个该全局变量相同的变量名，是会出错的。



### 静态局部变量和局部变量的区别

● 静态局部变量是属于常量区的，而函数内部的局部变量属于栈区。

● 静态局部变量在该函数调用结束时，不会销毁，而是随整个程序结束而结束，但是别的函数调用不了该变量，局部变量随该函数的结束而结束。

● 如果定义这两个变量的时候没有初始值时，静态局部变量会初始化为0，而局部变量就是一个随机值。

● 静态局部变量在编译期间只赋值一次，以后每次函数调用时，不再赋值，调用上次的函数调用结束时的值。局部变量在调用期间，每调用一次，赋一次值。



